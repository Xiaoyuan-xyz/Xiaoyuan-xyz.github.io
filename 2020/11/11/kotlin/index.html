<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>kotlin | Hexo</title>
  <meta name="keywords" content="">
  <meta name="description" content="kotlin | Hexo">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="kotlin基础 变量 函数 函数基础 函数参数化   面向表达式编程 表达式语句 枚举类 when 区间表达式 infix表达式   字符串   面向对象 类和对象 构造方法 构造方法 延迟初始化 主从构造方法   访问控制 继承 数据类型 object 伴生对象 object单例 object表达式     代数数据类型和模式匹配 积类型和和类型 模式匹配 增强Kotlin的模式匹配 类">
<meta property="og:type" content="article">
<meta property="og:title" content="kotlin">
<meta property="og:url" content="http://yoursite.com/2020/11/11/kotlin/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="kotlin基础 变量 函数 函数基础 函数参数化   面向表达式编程 表达式语句 枚举类 when 区间表达式 infix表达式   字符串   面向对象 类和对象 构造方法 构造方法 延迟初始化 主从构造方法   访问控制 继承 数据类型 object 伴生对象 object单例 object表达式     代数数据类型和模式匹配 积类型和和类型 模式匹配 增强Kotlin的模式匹配 类">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-11-11T08:12:06.270Z">
<meta property="article:modified_time" content="2020-11-11T08:12:18.619Z">
<meta property="article:author" content="Xiaoyuan-xyz">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/mokou.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1" ></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.0.1" ></script>

<meta name="generator" content="Hexo 4.2.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="true">
  <input class="theme_blog_path" value="">
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/mokou.jpg" />
</a>
<div class="author">
    <span>Xiaoyuan-xyz</span>
</div>

<div class="icon">
    
        
    
        
        <a title="github" href="https://github.com/Xiaoyuan-xyz/" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(21)</small></div></li>
    
        
            
            <li><div data-rel="计算机">计算机<small>(9)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="数学">数学<small>(8)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="红石原理">红石原理<small>(3)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a class="about  site_url"  href="/about.html">原始</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="21">
<input type="hidden" id="yelog_site_word_count" value="135.1k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode === 13){return false;}">
        <input id="local-search-input" class="search" type="text" placeholder="以 in: 开头进行全文搜索" />
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <div class="clearfix"></div>
</div>
    
    <div id=" local-search-result">

</div>

<nav id="title-list-nav">
    
    <a  class="计算机
        " href="/2020/02/25/CSS/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="CSS">CSS</span>
        <span class="post-date"
            title="2020-02-25 14:00:59">2020/02/25</span>
    </a>
    
    <a  class="计算机
        " href="/2020/02/24/HTML/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="HTML">HTML</span>
        <span class="post-date"
            title="2020-02-24 12:19:34">2020/02/24</span>
    </a>
    
    <a  class="计算机
        " href="/2020/03/15/JavaScript/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="JavaScript">JavaScript</span>
        <span class="post-date"
            title="2020-03-15 04:34:48">2020/03/15</span>
    </a>
    
    <a  class="计算机
        " href="/2020/06/18/cpp/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="cpp">cpp</span>
        <span class="post-date"
            title="2020-06-18 00:40:08">2020/06/18</span>
    </a>
    
    <a  class="" href="/2020/02/24/hello-world/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="Hello World">Hello World</span>
        <span class="post-date"
            title="2020-02-24 12:43:49">2020/02/24</span>
    </a>
    
    <a  class="计算机
        " href="/2020/06/18/python/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="python">python</span>
        <span class="post-date"
            title="2020-06-18 00:40:08">2020/06/18</span>
    </a>
    
    <a  class="数学
        " href="/2020/03/25/%E4%BB%A3%E6%95%B0%E6%8B%93%E6%89%91%E5%AD%A6/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="代数拓扑学">代数拓扑学</span>
        <span class="post-date"
            title="2020-03-25 00:35:06">2020/03/25</span>
    </a>
    
    <a  class="数学
        " href="/2020/03/24/%E5%A4%8D%E5%8F%98%E5%87%BD%E6%95%B0/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="复变函数">复变函数</span>
        <span class="post-date"
            title="2020-03-24 19:18:06">2020/03/24</span>
    </a>
    
    <a  class="数学
        " href="/2020/03/17/%E6%8A%BD%E4%BB%A3%E5%8D%83%E5%8F%B6%E6%8A%84/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="抽代千叶抄">抽代千叶抄</span>
        <span class="post-date"
            title="2020-03-17 01:02:39">2020/03/17</span>
    </a>
    
    <a  class="数学
        " href="/2020/03/01/%E6%8A%BD%E4%BB%A3%E9%80%9A%E5%AD%A6%E7%BB%8F%E8%B7%AF/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="抽代通学经路">抽代通学经路</span>
        <span class="post-date"
            title="2020-03-01 03:21:19">2020/03/01</span>
    </a>
    
    <a  class="数学
        " href="/2020/02/27/%E6%8A%BD%E8%B1%A1%E4%BB%A3%E6%95%B0/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="抽象代数">抽象代数</span>
        <span class="post-date"
            title="2020-02-27 04:17:26">2020/02/27</span>
    </a>
    
    <a  class="数学
        " href="/2020/02/25/%E6%A6%82%E7%8E%87%E8%AE%BA%E4%B8%8E%E6%95%B0%E7%90%86%E7%BB%9F%E8%AE%A1/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="概率论与数理统计">概率论与数理统计</span>
        <span class="post-date"
            title="2020-02-25 02:09:13">2020/02/25</span>
    </a>
    
    <a  class="数学
        " href="/2020/03/13/%E7%9F%A9%E9%98%B5%E8%AE%BA/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="矩阵论">矩阵论</span>
        <span class="post-date"
            title="2020-03-13 22:35:04">2020/03/13</span>
    </a>
    
    <a  class="红石原理
        " href="/2020/02/24/%E7%B2%98%E6%B6%B2%E5%9D%97%E5%8F%8A%E8%A7%82%E5%AF%9F%E8%80%85%E6%8A%80%E6%9C%AF/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="粘液块及观察者技术">粘液块及观察者技术</span>
        <span class="post-date"
            title="2020-02-24 12:19:48">2020/02/24</span>
    </a>
    
    <a  class="计算机
        " href="/2020/02/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%89%E7%BA%A7%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="计算机三级网络技术">计算机三级网络技术</span>
        <span class="post-date"
            title="2020-02-25 02:09:05">2020/02/25</span>
    </a>
    
    <a  class="红石原理
        " href="/2020/02/24/%E9%93%81%E8%BD%A8%E5%8F%8A%E7%9F%BF%E8%BD%A6%E7%B3%BB%E7%BB%9F/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="铁轨及矿车系统">铁轨及矿车系统</span>
        <span class="post-date"
            title="2020-02-24 12:19:48">2020/02/24</span>
    </a>
    
    <a  class="红石原理
        " href="/2020/03/11/%E6%96%B9%E5%9D%97%E6%9B%B4%E6%96%B0%E4%B8%8E%E5%BB%B6%E8%BF%9F%E7%90%86%E8%AE%BA%E7%9A%84%E6%8B%93%E5%B1%95/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="方块更新与延迟理论的拓展">方块更新与延迟理论的拓展</span>
        <span class="post-date"
            title="2020-03-11 22:25:44">2020/03/11</span>
    </a>
    
    <a  class="数学
        " href="/2020/03/04/%E7%82%B9%E9%9B%86%E6%8B%93%E6%89%91%E5%AD%A6/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="点集拓扑学">点集拓扑学</span>
        <span class="post-date"
            title="2020-03-04 19:17:10">2020/03/04</span>
    </a>
    
    <a  class="计算机
        " href="/2020/11/11/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="python数据分析">python数据分析</span>
        <span class="post-date"
            title="2020-11-11 16:10:33">2020/11/11</span>
    </a>
    
    <a  class="计算机
        " href="/2020/11/11/python%E7%88%AC%E8%99%AB/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="python爬虫">python爬虫</span>
        <span class="post-date"
            title="2020-11-11 16:10:20">2020/11/11</span>
    </a>
    
    <a  class="计算机
        " href="/2020/11/11/kotlin/"
        data-tag=""
        data-author="" >
            <span class="post-title" title="kotlin">kotlin</span>
        <span class="post-date"
            title="2020-11-11 16:12:06">2020/11/11</span>
    </a>
    
</nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-kotlin" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">kotlin</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a  data-rel="计算机">计算机</a>
            
        </span>
        
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2020-11-11 16:12:18'>2020-11-11 16:12</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:4.3k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#kotlin基础"><span class="toc-text">kotlin基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#变量"><span class="toc-text">变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#函数"><span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#函数基础"><span class="toc-text">函数基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#函数参数化"><span class="toc-text">函数参数化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#面向表达式编程"><span class="toc-text">面向表达式编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#表达式语句"><span class="toc-text">表达式语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#枚举类"><span class="toc-text">枚举类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#when"><span class="toc-text">when</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#区间表达式"><span class="toc-text">区间表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#infix表达式"><span class="toc-text">infix表达式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#字符串"><span class="toc-text">字符串</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#面向对象"><span class="toc-text">面向对象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#类和对象"><span class="toc-text">类和对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#构造方法"><span class="toc-text">构造方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#构造方法-1"><span class="toc-text">构造方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#延迟初始化"><span class="toc-text">延迟初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#主从构造方法"><span class="toc-text">主从构造方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#访问控制"><span class="toc-text">访问控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#继承"><span class="toc-text">继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据类型"><span class="toc-text">数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#object"><span class="toc-text">object</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#伴生对象"><span class="toc-text">伴生对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#object单例"><span class="toc-text">object单例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#object表达式"><span class="toc-text">object表达式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#代数数据类型和模式匹配"><span class="toc-text">代数数据类型和模式匹配</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#积类型和和类型"><span class="toc-text">积类型和和类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模式匹配"><span class="toc-text">模式匹配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#增强Kotlin的模式匹配"><span class="toc-text">增强Kotlin的模式匹配</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#类型测试-类型转换"><span class="toc-text">类型测试&#x2F;类型转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#面向对象的分解"><span class="toc-text">面向对象的分解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#访问者设计模式"><span class="toc-text">访问者设计模式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#类型系统"><span class="toc-text">类型系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#可空类型"><span class="toc-text">可空类型</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->

<ul>
<li><a href="#kotlin基础">kotlin基础</a><ul>
<li><a href="#变量">变量</a></li>
<li><a href="#函数">函数</a><ul>
<li><a href="#函数基础">函数基础</a></li>
<li><a href="#函数参数化">函数参数化</a></li>
</ul>
</li>
<li><a href="#面向表达式编程">面向表达式编程</a><ul>
<li><a href="#表达式语句">表达式语句</a></li>
<li><a href="#枚举类">枚举类</a></li>
<li><a href="#when">when</a></li>
<li><a href="#区间表达式">区间表达式</a></li>
<li><a href="#infix表达式">infix表达式</a></li>
</ul>
</li>
<li><a href="#字符串">字符串</a></li>
</ul>
</li>
<li><a href="#面向对象">面向对象</a><ul>
<li><a href="#类和对象">类和对象</a></li>
<li><a href="#构造方法">构造方法</a><ul>
<li><a href="#构造方法-1">构造方法</a></li>
<li><a href="#延迟初始化">延迟初始化</a></li>
<li><a href="#主从构造方法">主从构造方法</a></li>
</ul>
</li>
<li><a href="#访问控制">访问控制</a></li>
<li><a href="#继承">继承</a></li>
<li><a href="#数据类型">数据类型</a></li>
<li><a href="#object">object</a><ul>
<li><a href="#伴生对象">伴生对象</a></li>
<li><a href="#object单例">object单例</a></li>
<li><a href="#object表达式">object表达式</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#代数数据类型和模式匹配">代数数据类型和模式匹配</a><ul>
<li><a href="#积类型和和类型">积类型和和类型</a></li>
<li><a href="#模式匹配">模式匹配</a></li>
<li><a href="#增强kotlin的模式匹配">增强Kotlin的模式匹配</a><ul>
<li><a href="#类型测试类型转换">类型测试/类型转换</a></li>
<li><a href="#面向对象的分解">面向对象的分解</a></li>
<li><a href="#访问者设计模式">访问者设计模式</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#类型系统">类型系统</a><ul>
<li><a href="#可空类型">可空类型</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->

<h1 id="kotlin基础"><a href="#kotlin基础" class="headerlink" title="kotlin基础"></a>kotlin基础</h1><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>变量使用<code>var</code>声明，变量会自动进行类型推断，也可使用冒号显示声明变量类型。常量使用<code>val</code>声明。</p>
<p>常见数据类型包括：</p>
<ul>
<li>Byte</li>
<li>Short</li>
<li>Int</li>
<li>Long</li>
<li>Float</li>
<li>Double</li>
<li>String<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> intNum = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">var</span> byteNum:<span class="built_in">Byte</span> = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">val</span> PI = <span class="number">3.1415926</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><code>val</code>指的是varible+final，即引用不可变。但声明和初始化赋值可以分离。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> l = intArrayOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">l[<span class="number">0</span>] = <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> a: <span class="built_in">Int</span>;</span><br><span class="line">a = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>应当<strong>优先使用<code>val</code>、不可变对象及纯函数来设计程序</strong>。</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="函数基础"><a href="#函数基础" class="headerlink" title="函数基础"></a>函数基础</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    println(<span class="string">"Hello World!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>fun</code>声明函数，<code>main()</code>函数是程序的入口。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> 函数名<span class="params">(参数名:参数类型)</span></span>:返回类型&#123;</span><br><span class="line">    函数体</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>表达式作为函数体，返回类型自动推断（在没有递归的情形），当然也可以显式声明：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">add</span><span class="params">(a: <span class="type">Int</span>, b: <span class="type">Int</span>)</span></span> = a + b</span><br></pre></td></tr></table></figure>

<p>无返回值使用<code>Unit</code>。没有声明返回类型的函数会被当做无返回值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fun sayHello(name:String):Unit&#123;</span><br><span class="line">    println(&quot;大家好我叫$&#123;name&#125;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数参数化"><a href="#函数参数化" class="headerlink" title="函数参数化"></a>函数参数化</h3><p>函数类型由<code>()-&gt;</code>引导，括号内为参数类型，箭头后为返回值类型。不能省略Unit。</p>
<p>使用函数作为参数：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">filterStudent</span><span class="params">(students: <span class="type">List</span>&lt;<span class="type">Student</span>&gt;, assertion:(<span class="type">Student</span>)-&gt;<span class="type">Boolean</span>)</span></span>:List&lt;Student&gt;&#123;</span><br><span class="line">    <span class="keyword">val</span> res = mutableListOf&lt;Student&gt;()</span><br><span class="line">    <span class="keyword">for</span> (s <span class="keyword">in</span> students)&#123;</span><br><span class="line">        <span class="keyword">if</span> (assertion(s)) &#123;</span><br><span class="line">            res.add(s)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以使用匿名函数：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filterStudent(students, <span class="function"><span class="title">fun</span><span class="params">(student: <span class="type">Student</span>)</span></span>: <span class="built_in">Boolean</span> &#123; <span class="keyword">return</span> student.age == <span class="number">100</span> &#125;)</span><br></pre></td></tr></table></figure>

<p>lambda表达式由{}包裹，由-&gt;引导返回值。在指定lambda表达式类型时可以忽略函数内变量的类型声明；在声明函数内变量类型后可以自动推导lambda表达式类型。</p>
<p>函数只有花括号时，是代码块函数体，如果有返回值必须带<code>return</code>。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">fun1</span><span class="params">(x: <span class="type">Int</span>)</span></span> &#123; print(x) &#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">fun2</span><span class="params">(x:<span class="type">Int</span>, y:<span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123; <span class="keyword">return</span> x + y &#125;</span><br></pre></td></tr></table></figure>

<p>当没有等号也没有花括号时，是单表达式函数体，可以省略<code>return</code>。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">fun3</span><span class="params">(x:<span class="type">Int</span>, y:<span class="type">Int</span>)</span></span> = x + y</span><br></pre></td></tr></table></figure>

<p><code>= { ... }</code>形式是lambda表达式，参数在lambda表达式内部声明。所以如果前用<code>fun</code>声明，得到的就是lambda表达式函数体，必须用<code>invoke()</code>或<code>()</code>来调用。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> fun4 = &#123; x: <span class="built_in">Int</span>, y: <span class="built_in">Int</span> -&gt; x + y &#125; <span class="comment">// fun4(1, 2)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">fun5</span><span class="params">(x: <span class="type">Int</span>)</span></span> = &#123; y: <span class="built_in">Int</span> -&gt; x + y &#125; <span class="comment">// fun5(1)(2)</span></span><br></pre></td></tr></table></figure>

<p>因为<code>fun5</code>其实相当于返回lambda表达式：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">fun5</span><span class="params">(x: <span class="type">Int</span>)</span></span>: (<span class="built_in">Int</span>) -&gt; (<span class="built_in">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; y: <span class="built_in">Int</span> -&gt; x + y &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">foo</span><span class="params">(x: <span class="type">Int</span>)</span></span> = &#123; print(x) &#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">bar</span><span class="params">(x: <span class="type">Int</span>)</span></span> = run &#123; print(x) &#125;</span><br><span class="line">listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).forEach &#123; foo(it)() &#125;</span><br><span class="line">listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).forEach &#123; bar(it) &#125;</span><br></pre></td></tr></table></figure>

<p>当函数的最后一个参数是函数时，调用时可以将{}放在大括号外。如果仅有一个参数且为函数，调用时可以省略括号。</p>
<h2 id="面向表达式编程"><a href="#面向表达式编程" class="headerlink" title="面向表达式编程"></a>面向表达式编程</h2><h3 id="表达式语句"><a href="#表达式语句" class="headerlink" title="表达式语句"></a>表达式语句</h3><p>简略来说，表达式是有返回值的语句。在Kotlin中，if、try/catch/finally、函数体、lambda等都是表达式。</p>
<p>语句的作用就是服务于创建副作用（修改外部变量）的，而原则上的函数式编程，表达式不允许包含副作用。</p>
<p>Unit类型用以替代Java中的void，返回Unit类型表示没有返回值，让函数调用皆为表达式。</p>
<h3 id="枚举类"><a href="#枚举类" class="headerlink" title="枚举类"></a>枚举类</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="class"><span class="keyword">class</span> <span class="title">Day</span> </span>&#123;</span><br><span class="line">    MON,</span><br><span class="line">    TUE,</span><br><span class="line">    WEN,</span><br><span class="line">    THU,</span><br><span class="line">    FRI,</span><br><span class="line">    SAT,</span><br><span class="line">    SUN</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意在枚举属性和枚举方法之间必须要有一个分号来区分。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="class"><span class="keyword">class</span> <span class="title">DayOfWeek</span></span>(<span class="keyword">val</span> day: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    MON(<span class="number">1</span>),</span><br><span class="line">    TUE(<span class="number">2</span>),</span><br><span class="line">    WEN(<span class="number">3</span>),</span><br><span class="line">    THU(<span class="number">4</span>),</span><br><span class="line">    FRI(<span class="number">5</span>),</span><br><span class="line">    SAT(<span class="number">6</span>),</span><br><span class="line">    SUN(<span class="number">7</span>)</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getDayNumber</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> day</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="when"><a href="#when" class="headerlink" title="when"></a>when</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">schedule</span><span class="params">(sunny: <span class="type">Boolean</span>, day: <span class="type">Day</span>)</span></span>: String = <span class="keyword">when</span> (day) &#123;</span><br><span class="line">    Day.SAT -&gt; <span class="string">"play game"</span></span><br><span class="line">    Day.SUN -&gt; <span class="string">"finshing"</span></span><br><span class="line">    <span class="keyword">else</span> -&gt; <span class="keyword">when</span> &#123;</span><br><span class="line">        sunny -&gt; <span class="string">"outdoor"</span></span><br><span class="line">        <span class="keyword">else</span> -&gt; <span class="string">"study"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果没有声明when所判断的对象，when会以-&gt;左侧的逻辑值来进行选择。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">schedule</span><span class="params">(sunny: <span class="type">Boolean</span>, day: <span class="type">Day</span>)</span></span>: String = <span class="keyword">when</span> &#123;</span><br><span class="line">    day == Day.SAT -&gt; <span class="string">"play game"</span></span><br><span class="line">    day == Day.SUN -&gt; <span class="string">"finshing"</span></span><br><span class="line">    sunny -&gt; <span class="string">"outdoor"</span></span><br><span class="line">    <span class="keyword">else</span> -&gt; <span class="string">"study"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="区间表达式"><a href="#区间表达式" class="headerlink" title="区间表达式"></a>区间表达式</h3><p>区间表达式的用法：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>..<span class="number">10</span>) &#123;</span><br><span class="line">    println(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="infix表达式"><a href="#infix表达式" class="headerlink" title="infix表达式"></a>infix表达式</h3><p>infix表达式是类似于运算符的函数调用，也可以像普通函数一样调用：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">infix</span> <span class="function"><span class="keyword">fun</span> <span class="title">called</span><span class="params">(name: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">"My name is <span class="subst">$&#123;name&#125;</span>."</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> p = Person()</span><br><span class="line">    p called <span class="string">"Steve"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>map常用如下定义：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mapOf(</span><br><span class="line">    <span class="number">1</span> to <span class="string">"one"</span>,</span><br><span class="line">    <span class="number">2</span> to <span class="string">"two"</span>,</span><br><span class="line">    <span class="number">3</span> to <span class="string">"three"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">infix</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;A, B&gt;</span> A.<span class="title">to</span><span class="params">(that: <span class="type">B</span>)</span></span>: Pair&lt;A, B&gt; = Pair(<span class="keyword">this</span>, that)</span><br></pre></td></tr></table></figure>

<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p>字符串是不可变对象。生字符串使用三引号来引导。</p>
<p>字符串模板用$引导。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">sayHello</span><span class="params">(name:<span class="type">String</span>)</span></span>:String&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"大家好我叫<span class="subst">$&#123;name&#125;</span>"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h1><h2 id="类和对象"><a href="#类和对象" class="headerlink" title="类和对象"></a>类和对象</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">val</span> name: String = <span class="string">"Steve"</span></span><br><span class="line">    <span class="keyword">val</span> age: <span class="built_in">Int</span> = <span class="number">13</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Kotlin中的类，除非显式声明延迟初始化，否则必须指定默认值。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">flyable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">val</span> speed: <span class="built_in">Int</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">fly</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">"I can fly."</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Kotlin的接口通过方法来实现属性，所以不支持直接赋值常量，需要用<code>get()</code>。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Flyable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">val</span> height</span><br><span class="line">        <span class="keyword">get</span>() = <span class="number">1000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h2><h3 id="构造方法-1"><a href="#构造方法-1" class="headerlink" title="构造方法"></a>构造方法</h3><p>支持构造方法默认参数，来减少Java中的构造函数重载带来的麻烦。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bird</span></span>(<span class="keyword">val</span> age: <span class="built_in">Int</span> = <span class="number">1</span>, <span class="keyword">val</span> color: String = <span class="string">"blue"</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> bird = Bird(color = <span class="string">"black"</span>)</span><br></pre></td></tr></table></figure>

<p>构造方法参数名前的<code>val</code>和<code>var</code>其实表示在类内创建同名属性。</p>
<p>构造方法的参数只能在初始化类内属性成员或init语句块中调用。可以有多个init语句块，它们将会由上而下执行。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bird</span></span>(maybeWeight: <span class="built_in">Int</span>, <span class="keyword">val</span> color: String) &#123;</span><br><span class="line">    <span class="keyword">val</span> weight: <span class="built_in">Int</span> = <span class="keyword">if</span> (maybeWeight &gt; <span class="number">0</span>) maybeWeight <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        println(<span class="string">"do some other thing"</span>)</span><br><span class="line">        println(<span class="string">"the weight is <span class="subst">$&#123;maybeWeight&#125;</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Unresolved reference: maybeWeight</span></span><br><span class="line">    <span class="comment">// fun printWeight() &#123;</span></span><br><span class="line">    <span class="comment">//     println(maybeWeight)</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="延迟初始化"><a href="#延迟初始化" class="headerlink" title="延迟初始化"></a>延迟初始化</h3><p>类内属性必须立即初始化，除非显式延迟初始化。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> isAdult: <span class="built_in">Boolean</span> <span class="keyword">by</span> lazy(LazyThreadSafetyMode.NONE) &#123; age &gt;= <span class="number">18</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>lazy</code>接受其后的lambda，返回一个<code>Lazy&lt;T&gt;</code>。第一次访问属性时执行lambda并记录结果，以后只是返回记录的结果。因此，<code>by lazy</code>只用于常量，赋值后不再更改。</p>
<p><code>lazy</code>默认有同步锁(<code>LazyThreadSafetyMode.SYNCHRONIZED</code>)，并行模式<code>(LazyThreadSafetyMode.PUBLICATION</code>，<code>LazyThreadSafetyMode.NONE</code>将不会有任何线程开销。</p>
<p><code>var</code>应该使用<code>lateinit</code>。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> sex: String</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">printSex</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.sex = <span class="keyword">if</span> (<span class="keyword">this</span>.name == <span class="string">"Steve"</span>) <span class="string">"male"</span> <span class="keyword">else</span> <span class="string">"female"</span></span><br><span class="line">        println(<span class="keyword">this</span>.sex)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> sex: String</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">printSex</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.sex = <span class="keyword">if</span> (<span class="keyword">this</span>.name == <span class="string">"Steve"</span>) <span class="string">"male"</span> <span class="keyword">else</span> <span class="string">"female"</span></span><br><span class="line">        println(<span class="keyword">this</span>.sex)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="主从构造方法"><a href="#主从构造方法" class="headerlink" title="主从构造方法"></a>主从构造方法</h3><p>从构造方法通过<code>constructor</code>定义，用于接收特殊的数据来获取构造类的参数值。每个类最多有一个主构造方法和多个从构造方法，从构造方法直接或间接地委托主构造方法。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bird</span></span>(age: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> age: <span class="built_in">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(birth: DateTime) : <span class="keyword">this</span>(getAgeByBirth(birth))</span><br><span class="line">    <span class="keyword">constructor</span>(timestamp: <span class="built_in">Long</span>) : <span class="keyword">this</span>(DateTime(timestamp))</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getAgeByBirth</span><span class="params">(birth: <span class="type">DateTime</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Years.yearsBetween(birth, DateTime.now()).years</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h2><p>Kotlin默认类不允许继承，方法不允许重写，即<code>final</code>，需要用<code>open</code>允许继承。</p>
<p>密封类只允许在本文件继承，不能初始化，因为内部实现是一个抽象类。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">Bird</span> </span>&#123;</span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">fly</span><span class="params">()</span></span> = <span class="string">"I can fly"</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Eagle</span> : <span class="type">Bird</span></span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Kotlin默认类是<code>public</code>的。<code>protected</code>表示类及子类内可见；<code>private</code>在类内表示本类可见，在类外表示本文件可见；<code>internal</code>表示模块内可见。一个模块表示一起编译的Kotlin文件。</p>
<h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><p>Kotlin使用单冒号来继承。Kotlin只支持单继承。</p>
<p>多继承接口时，必须使用<code>override</code>实现接口属性和方法，可以用<code>super&lt;T&gt;</code>调用接口的默认方法。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Flyable</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">fly</span><span class="params">()</span></span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">kind</span><span class="params">()</span></span> = <span class="string">"flyable"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Runable</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">kind</span><span class="params">()</span></span> = <span class="string">"runable"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bird</span></span>(<span class="keyword">val</span> name:String):Flyable , Runable&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">fly</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">"bird can fly"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">"bird can run"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">kind</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>&lt;Flyable&gt;.kind()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>inner</code>声明内部类，使用内部类来解决多继承问题：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Horse</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">runFast</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">"I can run fast"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Donkey</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">doLongTimeThing</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">"I can do some thing long time"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mule</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">inner</span> <span class="class"><span class="keyword">class</span> <span class="title">HorseC</span> : <span class="type">Horse</span></span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">inner</span> <span class="class"><span class="keyword">class</span> <span class="title">DonkeyC</span> : <span class="type">Donkey</span></span>()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">runFast</span><span class="params">()</span></span> &#123;</span><br><span class="line">        HorseC().runFast()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">doLongTimeThing</span><span class="params">()</span></span> &#123;</span><br><span class="line">        DonkeyC().doLongTimeThing()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>by</code>用于委托，可以替代多继承。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Flyable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">fly</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Runable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flyer</span> : <span class="type">Flyable &#123;</span></span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">fly</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">"I can fly"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Runer</span> : <span class="type">Runable &#123;</span></span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">"I can run"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bird</span></span>(flyer: Flyer, runer: Runer) : Flyable <span class="keyword">by</span> flyer, Runable <span class="keyword">by</span> runer &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> flyer = Flyer()</span><br><span class="line">    <span class="keyword">val</span> runer = Runer()</span><br><span class="line">    <span class="keyword">val</span> bird = Bird(flyer, runer)</span><br><span class="line">    bird.fly()</span><br><span class="line">    bird.run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>用<code>data class</code>声明数据类，Kotlin会自动生成getter/setter，equals、hashCode、构造方法等函数。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Bird</span></span>(<span class="keyword">var</span> weight: <span class="built_in">Double</span>, <span class="keyword">var</span> age: <span class="built_in">Int</span>, <span class="keyword">var</span> color: String)</span><br></pre></td></tr></table></figure>

<p>反编译如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Bird</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">double</span> weight;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">   <span class="meta">@NotNull</span></span><br><span class="line">   <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">double</span> <span class="title">getWeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.weight;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setWeight</span><span class="params">(<span class="keyword">double</span> var1)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.weight = var1;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.age;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> var1)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.age = var1;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@NotNull</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.color;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(@NotNull String var1)</span> </span>&#123;</span><br><span class="line">      Intrinsics.checkNotNullParameter(var1, <span class="string">"&lt;set-?&gt;"</span>);</span><br><span class="line">      <span class="keyword">this</span>.color = var1;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Bird</span><span class="params">(<span class="keyword">double</span> weight, <span class="keyword">int</span> age, @NotNull String color)</span> </span>&#123;</span><br><span class="line">      Intrinsics.checkNotNullParameter(color, <span class="string">"color"</span>);</span><br><span class="line">      <span class="keyword">super</span>();</span><br><span class="line">      <span class="keyword">this</span>.weight = weight;</span><br><span class="line">      <span class="keyword">this</span>.age = age;</span><br><span class="line">      <span class="keyword">this</span>.color = color;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">double</span> <span class="title">component1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.weight;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">component2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.age;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@NotNull</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">component3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.color;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@NotNull</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Bird <span class="title">copy</span><span class="params">(<span class="keyword">double</span> weight, <span class="keyword">int</span> age, @NotNull String color)</span> </span>&#123;</span><br><span class="line">      Intrinsics.checkNotNullParameter(color, <span class="string">"color"</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Bird(weight, age, color);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// $FF: synthetic method</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> Bird copy$<span class="keyword">default</span>(Bird var0, <span class="keyword">double</span> var1, <span class="keyword">int</span> var3, String var4, <span class="keyword">int</span> var5, Object var6) &#123;</span><br><span class="line">      <span class="keyword">if</span> ((var5 &amp; <span class="number">1</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">         var1 = var0.weight;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((var5 &amp; <span class="number">2</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">         var3 = var0.age;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((var5 &amp; <span class="number">4</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">         var4 = var0.color;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> var0.copy(var1, var3, var4);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@NotNull</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"Bird(weight="</span> + <span class="keyword">this</span>.weight + <span class="string">", age="</span> + <span class="keyword">this</span>.age + <span class="string">", color="</span> + <span class="keyword">this</span>.color + <span class="string">")"</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">long</span> var10000 = Double.doubleToLongBits(<span class="keyword">this</span>.weight);</span><br><span class="line">      <span class="keyword">int</span> var1 = ((<span class="keyword">int</span>)(var10000 ^ var10000 &gt;&gt;&gt; <span class="number">32</span>) * <span class="number">31</span> + <span class="keyword">this</span>.age) * <span class="number">31</span>;</span><br><span class="line">      String var10001 = <span class="keyword">this</span>.color;</span><br><span class="line">      <span class="keyword">return</span> var1 + (var10001 != <span class="keyword">null</span> ? var10001.hashCode() : <span class="number">0</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(@Nullable Object var1)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span> != var1) &#123;</span><br><span class="line">         <span class="keyword">if</span> (var1 <span class="keyword">instanceof</span> Bird) &#123;</span><br><span class="line">            Bird var2 = (Bird)var1;</span><br><span class="line">            <span class="keyword">if</span> (Double.compare(<span class="keyword">this</span>.weight, var2.weight) == <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.age == var2.age &amp;&amp; Intrinsics.areEqual(<span class="keyword">this</span>.color, var2.color)) &#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>copy()</code>用于浅拷贝。如果数据类对象属性不可变，可以在拷贝时创建新对象。如果数据类对象属性可变，拷贝后要注意引用修改问题。</p>
<p><code>componentN()</code>用于结构，所以你可以写出这样的代码：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> bird = Bird(<span class="number">100.0</span>, <span class="number">10</span>, <span class="string">"blue"</span>)</span><br><span class="line"><span class="keyword">val</span> (weight, age, color) = bird</span><br></pre></td></tr></table></figure>

<p>数组也可以解构：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">val</span> birdInfo = <span class="string">"20.0,1,bule"</span></span><br><span class="line"><span class="keyword">val</span> (weight, age, color) = birdInfo.split(<span class="string">","</span>)</span><br></pre></td></tr></table></figure>

<p>对组和三元组的解构：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> pair = Pair(<span class="number">100.0</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">val</span> triple = Triple(<span class="number">100.0</span>, <span class="number">1</span>, <span class="string">"blue"</span>)</span><br><span class="line"><span class="keyword">val</span> (weightP, ageP) = pair</span><br><span class="line"><span class="keyword">val</span> (weightT, ageT, colorT) = triple</span><br></pre></td></tr></table></figure>

<h2 id="object"><a href="#object" class="headerlink" title="object"></a>object</h2><h3 id="伴生对象"><a href="#伴生对象" class="headerlink" title="伴生对象"></a>伴生对象</h3><p>伴生对象是从属于类的单例，用以替代Java中的静态成员。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Prize</span></span>(<span class="keyword">val</span> name: String, count: <span class="built_in">Int</span>, <span class="keyword">val</span> type: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> TYPE_REDPACK = <span class="number">0</span></span><br><span class="line">        <span class="keyword">val</span> TYPE_COUPON = <span class="number">1</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">isRedpack</span><span class="params">(prize: <span class="type">Prize</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> prize.type == TYPE_REDPACK</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="object单例"><a href="#object单例" class="headerlink" title="object单例"></a>object单例</h3><p>object是天生的单例</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> DatabaseConfig &#123;</span><br><span class="line">    <span class="keyword">var</span> host: String = <span class="string">"127.0.0.1"</span></span><br><span class="line">    <span class="keyword">var</span> port: <span class="built_in">Int</span> = <span class="number">3306</span></span><br><span class="line">    <span class="keyword">var</span> username: String = <span class="string">"root"</span></span><br><span class="line">    <span class="keyword">var</span> password: String = <span class="string">""</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="object表达式"><a href="#object表达式" class="headerlink" title="object表达式"></a>object表达式</h3><p>object表达式用于替代匿名内部类。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> absComparator = <span class="keyword">object</span> : Comparator&lt;<span class="built_in">Int</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">compare</span><span class="params">(o1: <span class="type">Int</span>?, o2: <span class="type">Int</span>?)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (o1 == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> (o2 == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> abs(o1) - abs(o2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Collections.sort(l, absComparator)</span><br></pre></td></tr></table></figure>

<p>也可以用lambda表达式，在内部类方法较多时用object表达式比较合适。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> absComparator = Comparator&lt;<span class="built_in">Int</span>&gt; &#123; o1, o2 -&gt;</span><br><span class="line">    <span class="keyword">if</span> (o1 == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span><span class="symbol">@Comparator</span> -<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> (o2 == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span><span class="symbol">@Comparator</span> <span class="number">1</span></span><br><span class="line">    abs(o1).compareTo(abs(o2))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="代数数据类型和模式匹配"><a href="#代数数据类型和模式匹配" class="headerlink" title="代数数据类型和模式匹配"></a>代数数据类型和模式匹配</h1><h2 id="积类型和和类型"><a href="#积类型和和类型" class="headerlink" title="积类型和和类型"></a>积类型和和类型</h2><p>代数数据类型是由其他数据类型组合得来的类型，常见的包括积类型和和类型。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooleanProductUnit</span></span>(a: <span class="built_in">Boolean</span>, b: <span class="built_in">Unit</span>) &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>除了枚举外，可以用密封类来创建和类型。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">Day</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">SUN</span> : <span class="type">Day</span></span>()</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MON</span> : <span class="type">Day</span></span>()</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TUE</span> : <span class="type">Day</span></span>()</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WEN</span> : <span class="type">Day</span></span>()</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">THU</span> : <span class="type">Day</span></span>()</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">FRI</span> : <span class="type">Day</span></span>()</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">SAT</span> : <span class="type">Day</span></span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>和类型 好处在于类型安全，<code>when</code>可以直接省略<code>else</code>。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">schedule</span><span class="params">(day: <span class="type">Day</span>)</span></span>: <span class="built_in">Unit</span> = <span class="keyword">when</span> (day) &#123;</span><br><span class="line">    <span class="keyword">is</span> Day.SUN -&gt; study()</span><br><span class="line">    <span class="keyword">is</span> Day.MON -&gt; study()</span><br><span class="line">    <span class="keyword">is</span> Day.TUE -&gt; study()</span><br><span class="line">    <span class="keyword">is</span> Day.WEN -&gt; study()</span><br><span class="line">    <span class="keyword">is</span> Day.THU -&gt; study()</span><br><span class="line">    <span class="keyword">is</span> Day.FRI -&gt; study()</span><br><span class="line">    <span class="keyword">is</span> Day.SAT -&gt; study()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h2><p>模式匹配本质上是匹配表达式。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 常量匹配</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">constantPattern</span><span class="params">(a: <span class="type">Int</span>)</span></span> = <span class="keyword">when</span> (a) &#123;</span><br><span class="line">    <span class="number">1</span> -&gt; <span class="string">"It is 1"</span></span><br><span class="line">    <span class="number">2</span> -&gt; <span class="string">"It is 2"</span></span><br><span class="line">    <span class="keyword">else</span> -&gt; <span class="string">"It is other number"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型匹配</span></span><br><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Circle</span></span>(<span class="keyword">val</span> radius: <span class="built_in">Double</span>) : Shape()</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span></span>(<span class="keyword">val</span> width: <span class="built_in">Double</span>, <span class="keyword">val</span> height: <span class="built_in">Double</span>) : Shape()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getArea</span><span class="params">(shape: <span class="type">Shape</span>)</span></span> = <span class="keyword">when</span> (shape) &#123;</span><br><span class="line">    <span class="keyword">is</span> Shape.Circle -&gt; Math.PI * shape.radius * shape.radius</span><br><span class="line">    <span class="keyword">is</span> Shape.Rectangle -&gt; shape.height * shape.width</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 逻辑表达式匹配</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">isAdult</span><span class="params">(age: <span class="type">Int</span>)</span></span> = <span class="keyword">when</span> &#123;</span><br><span class="line">    age <span class="keyword">in</span> <span class="number">0</span>..<span class="number">18</span> -&gt; (age.toString() + <span class="string">"岁尚未成年"</span>)</span><br><span class="line">    <span class="keyword">else</span> -&gt; <span class="string">"应该成年了"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于一个用于记录整数四则运算的表达式的嵌套类：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">Expr</span> </span>&#123;</span><br><span class="line">    <span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Num</span></span>(<span class="keyword">val</span> value: <span class="built_in">Int</span>) : Expr()</span><br><span class="line">    <span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Operate</span></span>(<span class="keyword">val</span> opName: String, <span class="keyword">val</span> left: Expr, <span class="keyword">val</span> right: Expr) : Expr()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在的业务需求是化简任何expr+0为expr：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">simplifyExpr</span><span class="params">(expr: <span class="type">Expr</span>)</span></span>: Expr = <span class="keyword">when</span> &#123;</span><br><span class="line">    expr <span class="keyword">is</span> Expr.Operate &amp;&amp; expr.opName == <span class="string">"+"</span> &amp;&amp; expr.left <span class="keyword">is</span> Expr.Num &amp;&amp; expr.left.value == <span class="number">0</span> -&gt; expr.right</span><br><span class="line">    expr <span class="keyword">is</span> Expr.Operate &amp;&amp; expr.opName == <span class="string">"+"</span> &amp;&amp; expr.right <span class="keyword">is</span> Expr.Num &amp;&amp; expr.right.value == <span class="number">0</span> -&gt; expr.left</span><br><span class="line">    <span class="keyword">else</span> -&gt; expr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以利用模式匹配化简如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">simplifyExpr</span><span class="params">(expr: <span class="type">Expr</span>)</span></span> = <span class="keyword">when</span> (expr) &#123;</span><br><span class="line">    <span class="keyword">is</span> Expr.Num -&gt; expr</span><br><span class="line">    <span class="keyword">is</span> Expr.Operate -&gt; <span class="keyword">when</span> (expr) &#123;</span><br><span class="line">        Expr.Operate(<span class="string">"+"</span>, expr.left, Expr.Num(<span class="number">0</span>)) -&gt; expr.left</span><br><span class="line">        Expr.Operate(<span class="string">"+"</span>, Expr.Num(<span class="number">0</span>), expr.right) -&gt; expr.right</span><br><span class="line">        <span class="keyword">else</span> -&gt; expr</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Kotlin还没有完全支持模式匹配，有些功能还不是非常强大。</p>
<h2 id="增强Kotlin的模式匹配"><a href="#增强Kotlin的模式匹配" class="headerlink" title="增强Kotlin的模式匹配"></a>增强Kotlin的模式匹配</h2><h3 id="类型测试-类型转换"><a href="#类型测试-类型转换" class="headerlink" title="类型测试/类型转换"></a>类型测试/类型转换</h3><p>在对类型进行测试后，可以直接当做该类型使用，因为Kotlin支持Smart Casts。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expr.left <span class="keyword">is</span> Expr.Num &amp;&amp; expr.left.value == <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="面向对象的分解"><a href="#面向对象的分解" class="headerlink" title="面向对象的分解"></a>面向对象的分解</h3><p>上述复杂的判断可以定义为函数：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">Expr</span> </span>&#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">isZero</span><span class="params">()</span></span>: <span class="built_in">Boolean</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">isAddZero</span><span class="params">()</span></span>: <span class="built_in">Boolean</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">left</span><span class="params">()</span></span>: Expr</span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">right</span><span class="params">()</span></span>: Expr</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Num</span></span>(<span class="keyword">val</span> value: <span class="built_in">Int</span>) : Expr() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">isZero</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> = <span class="keyword">this</span>.value == <span class="number">0</span></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">isAddZero</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">left</span><span class="params">()</span></span>: Expr = <span class="keyword">throw</span> Throwable(<span class="string">"no element"</span>)</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">right</span><span class="params">()</span></span>: Expr = <span class="keyword">throw</span> Throwable(<span class="string">"no element"</span>)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Operate</span></span>(<span class="keyword">val</span> opName: String, <span class="keyword">val</span> left: Expr, <span class="keyword">val</span> right: Expr) : Expr() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">isZero</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">isAddZero</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> = <span class="keyword">this</span>.opName == <span class="string">"+"</span> &amp;&amp; (<span class="keyword">this</span>.left.isZero() || <span class="keyword">this</span>.right.isZero())</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">left</span><span class="params">()</span></span>: Expr = <span class="keyword">this</span>.left</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">right</span><span class="params">()</span></span>: Expr = <span class="keyword">this</span>.right</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码虽然得到简化，但是类结构变得臃肿。如果业务比较简单，后期数据结构也不会发生大的变化可以使用这种方式。</p>
<h3 id="访问者设计模式"><a href="#访问者设计模式" class="headerlink" title="访问者设计模式"></a>访问者设计模式</h3><p>为类赋予访问者，在不改变类的条件下，定义作用于对象的新操作。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">Expr</span> </span>&#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">isZero</span><span class="params">(v: <span class="type">Visitor</span>)</span></span>: <span class="built_in">Boolean</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">isAddZero</span><span class="params">(v: <span class="type">Visitor</span>)</span></span>: <span class="built_in">Boolean</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">simplifyExpr</span><span class="params">(v: <span class="type">Visitor</span>)</span></span>: Expr</span><br><span class="line"></span><br><span class="line">    <span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Num</span></span>(<span class="keyword">val</span> value: <span class="built_in">Int</span>) : Expr() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">isZero</span><span class="params">(v: <span class="type">Visitor</span>)</span></span>: <span class="built_in">Boolean</span> = v.matchZero(<span class="keyword">this</span>)</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">isAddZero</span><span class="params">(v: <span class="type">Visitor</span>)</span></span>: <span class="built_in">Boolean</span> = v.matchAddZero(<span class="keyword">this</span>)</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">simplifyExpr</span><span class="params">(v: <span class="type">Visitor</span>)</span></span>: Expr = v.doSimplifyExpr(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Operate</span></span>(<span class="keyword">val</span> opName: String, <span class="keyword">val</span> left: Expr, <span class="keyword">val</span> right: Expr) : Expr() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">isZero</span><span class="params">(v: <span class="type">Visitor</span>)</span></span>: <span class="built_in">Boolean</span> = v.matchZero(<span class="keyword">this</span>)</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">isAddZero</span><span class="params">(v: <span class="type">Visitor</span>)</span></span>: <span class="built_in">Boolean</span> = v.matchAddZero(<span class="keyword">this</span>)</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">simplifyExpr</span><span class="params">(v: <span class="type">Visitor</span>)</span></span>: Expr = v.doSimplifyExpr(<span class="keyword">this</span>, v)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">matchAddZero</span><span class="params">(expr: <span class="type">Expr</span>.<span class="type">Num</span>)</span></span>: <span class="built_in">Boolean</span> = <span class="literal">false</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">matchZero</span><span class="params">(expr: <span class="type">Expr</span>.<span class="type">Num</span>)</span></span>: <span class="built_in">Boolean</span> = expr.value == <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">doSimplifyExpr</span><span class="params">(expr: <span class="type">Expr</span>.<span class="type">Num</span>)</span></span>: Expr = expr</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">matchAddZero</span><span class="params">(expr: <span class="type">Expr</span>.<span class="type">Operate</span>)</span></span>: <span class="built_in">Boolean</span> = <span class="keyword">when</span> (expr) &#123;</span><br><span class="line">        Expr.Operate(<span class="string">"+"</span>, expr.left, Expr.Num(<span class="number">0</span>)) -&gt; <span class="literal">true</span></span><br><span class="line">        Expr.Operate(<span class="string">"+"</span>, Expr.Num(<span class="number">0</span>), expr.right) -&gt; <span class="literal">true</span></span><br><span class="line">        <span class="keyword">else</span> -&gt; <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">matchZero</span><span class="params">(expr: <span class="type">Expr</span>.<span class="type">Operate</span>)</span></span>: <span class="built_in">Boolean</span> = <span class="literal">false</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">doSimplifyExpr</span><span class="params">(expr: <span class="type">Expr</span>.<span class="type">Operate</span>, v: <span class="type">Visitor</span>)</span></span>: Expr = <span class="keyword">when</span> &#123;</span><br><span class="line">        expr.right <span class="keyword">is</span> Expr.Num &amp;&amp; expr.right.isZero(v) -&gt; expr.left</span><br><span class="line">        expr.left <span class="keyword">is</span> Expr.Num &amp;&amp; expr.left.isZero(v) -&gt; expr.right</span><br><span class="line">        <span class="keyword">else</span> -&gt; expr</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问者设计模式将类的方法放到类的外部，可以减少许多类型判断的代码，只在指定的子类进行操作使逻辑变得轻巧。</p>
<p>访问者设计模式不便于后期维护，只有在数据结构不会有太大的改变，以及业务逻辑相对比较复杂时使用。</p>
<h1 id="类型系统"><a href="#类型系统" class="headerlink" title="类型系统"></a>类型系统</h1><h2 id="可空类型"><a href="#可空类型" class="headerlink" title="可空类型"></a>可空类型</h2><p><code>?</code>表示允许空值的类型：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Seat</span></span>(<span class="keyword">val</span> student: Student?)</span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br></pre></td></tr></table></figure>

<p><code>?.</code>表示安全调用：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">println(<span class="string">"座位上坐的学生是<span class="subst">$&#123;s.student?.name&#125;</span>"</span>)</span><br></pre></td></tr></table></figure>

<p><code>?:</code>被称为Elvis操作符，指定空变量的返回值，类似三目运算符。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">println(<span class="string">"座位上的学生年龄是<span class="subst">$&#123;s.student?.age ?: <span class="number">-1</span>&#125;</span>"</span>)</span><br></pre></td></tr></table></figure>

<p><code>!!.</code>为非空断言，如果变量为空则会抛出NPE异常。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">println(s.student!!.name)</span><br></pre></td></tr></table></figure>

<p>除此之外还有<code>!is</code>、<code>as?</code>等运算符。</p>
<p>Kotlin实现可空参数的方式是<code>@Nullable</code>加<code>if..else</code>判断。这么做应该是为了在最好性能的前提下兼容Java。</p>
<p>可以用Elvis运算符抛出异常：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">println(<span class="string">"座位上的学生年龄是<span class="subst">$&#123;s.student?.age?: throw NullPointerException()&#125;</span>"</span>)</span><br></pre></td></tr></table></figure>

<p>如果实现一个Either类，可以做出：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">Either</span>&lt;<span class="type">A, B</span>&gt;</span>() &#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Left</span>&lt;<span class="type">A, B</span>&gt;</span>(<span class="keyword">val</span> Value: A) : Either&lt;A, B&gt;()</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Right</span>&lt;<span class="type">A, B</span>&gt;</span>(<span class="keyword">val</span> Value: B) : Either&lt;A, B&gt;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getName</span><span class="params">(seat: <span class="type">Seat</span>?)</span></span>: Either&lt;Error, String&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> seat?.student?.let &#123; Either.Right&lt;Error, String&gt;(it.name) &#125; ?: Either.Left&lt;Error, String&gt;(Error())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中<code>let</code>将自己(it)作为其后的表达式参数，进行运算。</p>

      
       <hr><span style="font-style: italic;color: gray;"> article_txt </span>
    </div>
</article>





    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: '69419311f033b29ef0d4',
            clientSecret: '180dfad4620a5a2774b1f9d6775a71d714fd2782',
            repo: 'blogtalk',
            owner: 'Xiaoyuan-xyz',
            admin: ['Xiaoyuan-xyz'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    
        <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<input type="hidden" id="MathJax-js"
        value="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</input>
    




    </div>
    <div class="copyright">
        <p class="footer-entry">bottom_text</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" ></a>

    </div>
</div>
<div class="acParent"></div>

</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': [],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().split('\n').length - 1, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: #fafafa;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.2;
        background: url("https://i.loli.net/2020/03/07/2MQXpPDfqyT8ERo.jpg");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
    .post .pjax article :not(pre) > code {
        color: #24292e;
        font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
        background-color: rgba(27,31,35,.05);
        border-radius: 3px;
        font-size: 85%;
        margin: 0;
        padding: .2em .4em;
    }
    
</style>







</html>
